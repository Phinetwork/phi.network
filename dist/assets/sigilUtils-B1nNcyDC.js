const e=(3+Math.sqrt(5))*1e3,t=()=>Math.floor((Date.now()-1715323541888)/e),n=`https://schema.phi.network/sigil/v1`,r=`application/phi.kairos.sigil+svg`,i=2e3,a=e=>Array.from(e).map(e=>e.toString(16).padStart(2,`0`)).join(``);async function o(e){let t=typeof e==`string`?new TextEncoder().encode(e):e,n=await crypto.subtle.digest(`SHA-256`,t);return a(new Uint8Array(n))}var s=`123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz`;function c(e){let t=0n;for(let n of e)t=(t<<8n)+BigInt(n);let n=``;for(;t>0n;)n=s[Number(t%58n)]+n,t/=58n;for(let t=0;t<e.length&&e[t]===0;t++)n=`1`+n;return n}async function l(e,t=0){let n=new Uint8Array(1+e.length);n[0]=t,n.set(e,1);let r=await crypto.subtle.digest(`SHA-256`,n),i=await crypto.subtle.digest(`SHA-256`,r),a=new Uint8Array(i).slice(0,4),o=new Uint8Array(n.length+4);return o.set(n),o.set(a,n.length),c(o)}const u={encode(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=+$/g,``)},decode(e){let t=e.replace(/-/g,`+`).replace(/_/g,`/`)+`===`.slice((e.length+3)%4),n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}};async function d(e){let t=u.decode(e),n=await crypto.subtle.digest(`SHA-256`,t);return l(new Uint8Array(n).slice(0,20),0)}async function f(e,t){return o(new TextEncoder().encode(e+`|`+t))}async function p(e){if(e.length===0)return`0`.repeat(64);let t=e.slice();for(;t.length>1;){let e=[];for(let n=0;n<t.length;n+=2){let r=t[n],i=n+1<t.length?t[n+1]:t[n],[a,o]=r<=i?[r,i]:[i,r];e.push(await f(a,o))}t=e}return t[0]}async function m(e,t){if(e.length===0)return{leaf:`0`.repeat(64),index:0,siblings:[]};let n=t,r=e.slice(),i=[];for(;r.length>1;){let e=n%2==1?n-1:n+1,t=r[e]??r[n];i.push(t);let a=[];for(let e=0;e<r.length;e+=2){let t=r[e],n=e+1<r.length?r[e+1]:r[e];a.push(await f(t<=n?t:n,t<=n?n:t))}r=a,n=Math.floor(n/2)}return{leaf:e[t],index:t,siblings:i}}async function h(e,t){let n=t.leaf,r=t.index;for(let e of t.siblings){let t=r%2==0?[n,e]:[e,n];n=await f(t[0]<=t[1]?t[0]:t[1],t[0]<=t[1]?t[1]:t[0]),r=Math.floor(r/2)}return n===e}var g=[`Root`,`Sacral`,`Solar Plexus`,`Heart`,`Throat`,`Third Eye`,`Crown`].reduce((e,t)=>(e[t.toLowerCase()]=t,e),{});function _(e){let t=e.toLowerCase().trim().replace(/[-_]/g,` `).replace(/\b(gate|chakra|day)\b/g,``).replace(/\s+/g,` `).trim();return/(third\s*eye)/.test(t)?`third eye`:/(solar\s*plexus)/.test(t)?`solar plexus`:t}function v(e){if(typeof e!=`string`)return null;let t=_(e),n=g[t];if(n)return n;switch(t){case`root`:return`Root`;case`sacral`:return`Sacral`;case`solar`:case`plexus`:return`Solar Plexus`;case`heart`:return`Heart`;case`throat`:return`Throat`;case`third`:case`eye`:return`Third Eye`;case`crown`:return`Crown`;default:return null}}function y(e){return v(e.chakraDay??``)||v(e.chakraGate??``)||null}const b={CTX:n,TYPE:r};function x(e){return(!e[`@context`]||e[`@context`]===b.CTX)&&(!e.type||e.type===b.TYPE)}function S(e){if(typeof e!=`object`||!e)return JSON.stringify(e);if(Array.isArray(e))return`[`+e.map(S).join(`,`)+`]`;let t=e;return`{`+Object.keys(t).sort().map(e=>JSON.stringify(e)+`:`+S(t[e])).join(`,`)+`}`}async function C(e){let{pulse:t,beat:n,stepIndex:r,chakraDay:i}=e;return typeof t!=`number`||typeof n!=`number`||typeof r!=`number`||typeof i!=`string`?null:o(`${t}|${n}|${r}|${i}|${e.intentionSigil??``}`)}async function w(e){let t=await o(e+`Ï†`),n=new Uint8Array(20);for(let e=0;e<20;e++)n[e]=parseInt(t.slice(e*2,e*2+2),16);return l(n,0)}function T(e){let t={senderSignature:e.senderSignature,senderStamp:e.senderStamp,senderKaiPulse:e.senderKaiPulse};return e.payload&&(t.payload={name:e.payload.name,mime:e.payload.mime,size:e.payload.size}),e.receiverSignature&&(t.receiverSignature=e.receiverSignature),e.receiverStamp&&(t.receiverStamp=e.receiverStamp),e.receiverKaiPulse!=null&&(t.receiverKaiPulse=e.receiverKaiPulse),t}async function E(e){return o(JSON.stringify(T(e)))}function D(e){let t={senderSignature:e.senderSignature,senderStamp:e.senderStamp,senderKaiPulse:e.senderKaiPulse};return e.payload&&(t.payload={name:e.payload.name,mime:e.payload.mime,size:e.payload.size}),t}async function O(e){return o(JSON.stringify(D(e)))}async function k(e){return p(await Promise.all(e.map(E)))}async function A(e,t){return o(S({pulse:e.pulse??0,beat:e.beat??0,stepIndex:e.stepIndex??0,chakraDay:e.chakraDay??``,kaiSignature:e.kaiSignature??``,creatorPublicKey:e.creatorPublicKey??``,cumulativeTransfers:t??e.cumulativeTransfers??0,segments:(e.segments??[]).map(e=>({index:e.index,root:e.root,cid:e.cid,count:e.count})),segmentsMerkleRoot:e.segmentsMerkleRoot??``}))}function j(e){return(e.segments??[]).reduce((e,t)=>e+(t.count||0),0)}async function M(e,t){return A(e,j(e)+t)}function N(e,t){let n=v(e.chakraDay)??`Root`,r={v:1,type:`send`,sigil:{pulse:e.pulse??0,beat:e.beat??0,stepIndex:e.stepIndex??0,chakraDay:n,kaiSignature:e.kaiSignature??``},previousHeadRoot:t.previousHeadRoot,senderKaiPulse:t.senderKaiPulse,senderPubKey:t.senderPubKey,nonce:t.nonce,transferLeafHashSend:t.transferLeafHashSend};return new TextEncoder().encode(S(r))}function P(e){let t={v:1,type:`receive`,link:e.senderSig,previousHeadRoot:e.previousHeadRoot,receiverKaiPulse:e.receiverKaiPulse,receiverPubKey:e.receiverPubKey,transferLeafHashReceive:e.transferLeafHashReceive};return new TextEncoder().encode(S(t))}async function F(e){return o(JSON.stringify({pulse:e.pulse,beat:e.beat,stepIndex:e.stepIndex,chakraDay:e.chakraDay,kaiSignature:e.kaiSignature,userPhiKey:e.userPhiKey,cumulativeTransfers:e.cumulativeTransfers??0,segments:(e.segments??[]).map(e=>({index:e.index,root:e.root,cid:e.cid,count:e.count})),segmentsMerkleRoot:e.segmentsMerkleRoot??``}))}function I(e){let t=JSON.stringify(e);return btoa(unescape(encodeURIComponent(t))).replace(/\+/g,`-`).replace(/\//g,`_`).replace(/=+$/g,``)}function L(){let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e).map(e=>e.toString(16).padStart(2,`0`)).join(``)}async function R(e){return o(S(e))}async function z(e){let t=JSON.stringify(e),n=await crypto.subtle.digest(`SHA-256`,new TextEncoder().encode(t));return[...new Uint8Array(n)].map(e=>e.toString(16).padStart(2,`0`)).join(``)}export{t as A,h as C,i as D,o as E,n as O,m as S,d as T,S as _,k as a,p as b,w as c,R as d,E as f,x as g,A as h,N as i,r as k,M as l,F as m,I as n,C as o,O as p,P as r,z as s,b as t,L as u,j as v,u as w,f as x,y};