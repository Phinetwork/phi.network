/* ─────────────────────────────────────────────────────────────
   Glyph Stream — Divine Feed Styles (Kai-φ coherence edition)
   Mobile-first, overflow-proof, safe-area aware, a11y strong.
   ───────────────────────────────────────────────────────────── */

/* ---------- Base reset (scoped) ---------- */
:root {
  color-scheme: dark light;

  /* Palette (dark default) */
  --bg: #07090b;
  --bg-2: #0b0f14;
  --bg-3: #0f141a;
  --text: #e7edf3;
  --text-dim: #cbd6e2;
  --text-soft: #9fb0c4;

  /* Golds (φ) */
  --gold-1: #f6e27a;
  --gold-2: #ffdf8a;
  --gold-3: #ffd166;
  --gold-4: #f4c361;

  /* Auras */
  --aqua: #7dd3fc;
  --violet: #c4b5fd;
  --teal: #2dd4bf;

  /* Surfaces */
  --glass: rgba(255,255,255,0.06);
  --glass-2: rgba(255,255,255,0.08);
  --glass-3: rgba(255,255,255,0.12);
  --stroke: rgba(255,255,255,0.14);
  --stroke-soft: rgba(255,255,255,0.10);

  /* Shadows */
  --shadow-1: 0 10px 30px rgba(0,0,0,.35);
  --shadow-2: 0 16px 44px rgba(0,0,0,.45);
  --shadow-glow: 0 0 0 1px rgba(255,220,130,.35), 0 0 40px rgba(255,220,130,.12);

  /* Radii */
  --r-xs: 8px;
  --r-sm: 12px;
  --r-md: 16px;
  --r-lg: 20px;
  --r-xl: 28px;

  /* Spacing (φ-proportions) */
  --φ: 1.618;
  --space-1: 8px;
  --space-2: calc(var(--space-1) * var(--φ));
  --space-3: calc(var(--space-2) * var(--φ));
  --space-4: calc(var(--space-3) * var(--φ));
  --space-5: calc(var(--space-4) * var(--φ));

  /* Timing */
  --breath: 5.236s;
  --ease-breath: cubic-bezier(.22,.61,.36,1);
  --ease-snap: cubic-bezier(.17,.84,.44,1);

  /* Typography */
  --h1: clamp(26px, 7vw, 46px);
  --h2: clamp(18px, 3.6vw, 26px);
  --p: clamp(14px, 2.9vw, 17px);

  /* Backdrop strength */
  --blur: 14px;

  /* Layout */
  --container: min(1100px, 100vw);
}

@media (prefers-color-scheme: light) {
  :root {
    --bg: #fbfcfe;
    --bg-2: #f5f7fb;
    --bg-3: #eef2f8;
    --text: #0d1117;
    --text-dim: #223046;
    --text-soft: #4a5668;

    --glass: rgba(0,0,0,0.05);
    --glass-2: rgba(0,0,0,0.07);
    --glass-3: rgba(0,0,0,0.10);
    --stroke: rgba(0,0,0,0.14);
    --stroke-soft: rgba(0,0,0,0.10);

    --shadow-1: 0 10px 22px rgba(21,31,44,.10);
    --shadow-2: 0 18px 42px rgba(21,31,44,.16);
    --shadow-glow: 0 0 0 1px rgba(180,120,20,.18), 0 0 38px rgba(240,200,120,.12);
  }
}

/* Ensure no horizontal scroll on any device */
html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: clip;
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* Media blocks fluid */
img, svg, video, canvas { max-width: 100%; height: auto; display: block; }

/* Long text safety */
pre, code, kbd, samp {
  white-space: pre-wrap;
  word-break: break-word;
  overflow-wrap: anywhere;
}

a, button { -webkit-tap-highlight-color: transparent; }

/* ---------- Page root ---------- */
.sf {
  width: var(--container);
  margin-inline: auto;
  padding: max(var(--space-3), env(safe-area-inset-top, 0px))
           max(var(--space-2), env(safe-area-inset-right, 0px))
           var(--space-4)
           max(var(--space-2), env(safe-area-inset-left, 0px));
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  color: var(--text);
  background:
    radial-gradient(1200px 700px at 15% -10%, rgba(255,214,130,.12), transparent 60%),
    radial-gradient(1000px 640px at 95% 10%, rgba(152,222,255,.10), transparent 60%),
    linear-gradient(180deg, var(--bg-2), var(--bg));
  min-height: 100svh;
  overflow-x: clip;
  animation: φ-breath-bg var(--breath) var(--ease-breath) infinite alternate;
}
@media (prefers-reduced-motion: reduce) { .sf { animation: none; } }
.sf > * { min-width: 0; }

/* ---------- Header card ---------- */
.sf-head {
  display: flex;
  flex-direction: column;
  gap: calc(var(--space-2) * .9);
  position: relative;
  padding: var(--space-3);
  border-radius: var(--r-xl);
  border: 1px solid var(--stroke);
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)) padding-box,
    radial-gradient(1200px 600px at 10% -20%, rgba(255,220,120,.18), transparent 65%) border-box;
  box-shadow: var(--shadow-1);
}
@supports (backdrop-filter: blur(1px)) { .sf-head { backdrop-filter: blur(var(--blur)); } }

.sf-head h1 {
  font-size: var(--h1);
  line-height: 1.12;
  letter-spacing: .2px;
  margin: 0;
  background: linear-gradient(92deg, var(--gold-2) 0%, var(--gold-3) 35%, var(--aqua) 70%, var(--violet) 100%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  filter: drop-shadow(0 6px 20px rgba(255,208,120,.18));
  animation: φ-breath-shimmer var(--breath) var(--ease-breath) infinite alternate;
}
@media (prefers-reduced-motion: reduce) { .sf-head h1 { animation: none; } }

.sf-sub {
  font-size: var(--p);
  color: var(--text-dim);
  margin: 4px 0 0 0;
  word-break: break-word;
  overflow-wrap: anywhere;
}

/* ---------- Payload banner ---------- */
.sf-payload {
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.025));
  border-radius: var(--r-lg);
  padding: calc(var(--space-2) * 1.1);
  box-shadow: var(--shadow-glow);
  display: grid;
  gap: calc(var(--space-2) * .8);
}
@supports (backdrop-filter: blur(1px)) { .sf-payload { backdrop-filter: blur(var(--blur)); } }

.sf-payload-line {
  display: flex;
  flex-wrap: wrap;
  gap: .5rem;
  word-break: break-word;
  overflow-wrap: anywhere;
}

.sf-pill {
  --pill-bg: rgba(255,255,255,.08);
  display: inline-flex;
  align-items: center;
  gap: .5ch;
  padding: .38rem .66rem;
  border-radius: 999px;
  border: 1px solid var(--stroke-soft);
  background: var(--pill-bg);
  font-size: 12.5px;
  color: var(--text-dim);
  white-space: nowrap;
}
.sf-pill--source { --pill-bg: linear-gradient(90deg, rgba(255,223,138,.18), rgba(255,223,138,.06)); color: #2e2a12; }
.sf-pill--author { --pill-bg: rgba(125,211,252,.12); }
.sf-pill--sigil  { --pill-bg: rgba(196,181,253,.12); }
.sf-pill--phikey { --pill-bg: rgba(45,212,191,.12); }
.sf-pill--ksig   { --pill-bg: linear-gradient(90deg, rgba(196,181,253,.16), rgba(125,211,252,.14)); }

.sf-payload-core {
  font-size: clamp(16px, 2.6vw, 20px);
  color: var(--text);
  font-weight: 600;
  letter-spacing: .2px;
  word-break: break-word;
  overflow-wrap: anywhere;
}
.sf-kai-label { font-weight: 500; color: var(--gold-2); opacity: .95; }
.sf-caption   { color: var(--text-dim); font-weight: 500; }

/* ---------- Reply Composer ---------- */
.sf-reply {
  margin-top: var(--space-3);
  display: grid;
  gap: var(--space-2);
  padding: var(--space-3);
  border-radius: var(--r-xl);
  border: 1px solid var(--stroke);
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)) padding-box,
    radial-gradient(1200px 600px at 100% -20%, rgba(152,222,255,.16), transparent 70%) border-box;
  box-shadow: var(--shadow-1);
  /* show wrapped content fully */
  overflow: visible;
}
@supports (backdrop-filter: blur(1px)) { .sf-reply { backdrop-filter: blur(var(--blur)); } }

.sf-reply-title {
  font-size: var(--h2);
  margin: 0;
  letter-spacing: .2px;
  background: linear-gradient(92deg, var(--gold-2), var(--aqua));
  -webkit-background-clip: text; background-clip: text; color: transparent;
}

.sf-reply-login {
  border: 1px dashed var(--stroke);
  border-radius: var(--r-lg);
  padding: calc(var(--space-2) * 1.2);
  background: var(--glass);
}

/* identity chips row – allow wrapping */
.sf-reply-id {
  display: flex;
  flex-wrap: wrap;
  gap: .5rem;
  min-width: 0;
  width: 100%;
}
.sf-reply-id .sf-pill {
  max-width: 100%;
  flex-wrap: wrap;
  align-items: flex-start;
  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-all;
  line-break: anywhere;
}

/* rows */
.sf-reply-row { display: grid; gap: .5rem; min-width: 0; }

.sf-label  { font-size: 13px; font-weight: 600; color: var(--text-dim); }
.sf-muted  { color: var(--text-soft); font-weight: 500; }

/* Inputs */
.sf-input,
.sf-textarea {
  width: 100%;
  padding: .78rem 1rem;
  border-radius: var(--r-lg);
  border: 1px solid var(--stroke);
  background: var(--glass);
  color: var(--text);
  outline: none;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  transition: border-color .18s var(--ease-snap), box-shadow .18s var(--ease-snap), background .18s var(--ease-snap);
  font-size: 16px;
  line-height: 1.35;
}
.sf-input::placeholder,
.sf-textarea::placeholder { color: var(--text-soft); opacity: .8; }

.sf-input:focus-visible,
.sf-textarea:focus-visible {
  border-color: rgba(255,214,120,.55);
  box-shadow: var(--shadow-glow);
  background: var(--glass-2);
}

.sf-input--locked { pointer-events: none; user-select: all; opacity: .9; }

/* Warn helper */
.sf-warn {
  margin-top: .4rem;
  font-size: 12.5px;
  color: #ffefc7;
  background: linear-gradient(180deg, rgba(255,214,120,.12), rgba(255,214,120,.06));
  border: 1px solid rgba(255,214,120,.35);
  padding: .5rem .7rem;
  border-radius: var(--r-md);
}

/* Actions */
.sf-reply-actions { display: flex; gap: .66rem; align-items: center; flex-wrap: wrap; }

/* Buttons */
.sf-btn {
  padding: .78rem 1.05rem;
  border-radius: var(--r-lg);
  border: 1px solid rgba(255,223,138,.42);
  color: #2a230a;
  background:
    radial-gradient(120% 140% at 0% 0%, rgba(255,245,220,.95), rgba(255,230,170,.92) 40%, rgba(255,214,120,.88) 100%);
  box-shadow:
    0 2px 0 rgba(255,210,120,.6) inset,
    0 12px 28px rgba(255,214,120,.18),
    0 2px 0 rgba(255,255,255,.24);
  font-weight: 700;
  letter-spacing: .2px;
  cursor: pointer;
  min-height: 44px;
  transition: transform .15s var(--ease-snap), box-shadow .2s var(--ease-snap), filter .2s var(--ease-snap);
}
.sf-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-2), 0 0 0 1px rgba(255,214,120,.25) inset; }
.sf-btn:active { transform: translateY(0); filter: brightness(.98); }
.sf-btn:focus-visible { outline: none; box-shadow: var(--shadow-glow), 0 0 0 3px rgba(255,214,120,.25); }
.sf-btn[disabled] { opacity: .6; cursor: not-allowed; transform: none; }

.sf-btn--ghost {
  background: transparent; color: var(--text);
  border: 1px solid var(--stroke); box-shadow: none;
}
.sf-btn--ghost:hover { background: var(--glass-2); box-shadow: var(--shadow-1); }

/* Reply result card */
.sf-reply-result {
  display: grid; gap: .6rem; padding: var(--space-2);
  border-radius: var(--r-lg);
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  overflow: visible;
}

/* Link button */
.sf-link {
  display: inline-flex; align-items: center; gap: .4rem;
  text-decoration: none; font-weight: 700; letter-spacing: .2px;
  color: var(--gold-2); padding: .6rem .85rem;
  border: 1px solid rgba(255,223,138,.35);
  border-radius: var(--r-lg);
  background: rgba(255,223,138,.07);
  transition: transform .15s var(--ease-snap), box-shadow .2s var(--ease-snap);
  word-break: break-word; overflow-wrap: anywhere;
}
.sf-link:hover { transform: translateY(-1px); box-shadow: var(--shadow-1); }

/* ---------- Add controls ---------- */
.sf-add { display: grid; grid-template-columns: 1fr auto; gap: .66rem; align-items: start; }

.sf-add textarea {
  width: 100%; min-height: 98px; padding: .85rem 1rem;
  border-radius: var(--r-lg); border: 1px solid var(--stroke);
  background: var(--glass); color: var(--text);
  outline: none; box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  transition: border-color .18s var(--ease-snap), box-shadow .18s var(--ease-snap), background .18s var(--ease-snap);
  word-break: break-word; overflow-wrap: anywhere; font-size: 16px;
}
.sf-add textarea::placeholder { color: var(--text-soft); opacity: .8; }
.sf-add textarea:focus-visible { border-color: rgba(255,214,120,.55); box-shadow: var(--shadow-glow); background: var(--glass-2); }

.sf-add button {
  padding: .78rem 1.05rem; border-radius: var(--r-lg);
  border: 1px solid rgba(255,223,138,.42); color: #2a230a;
  background: radial-gradient(120% 140% at 0% 0%, rgba(255,245,220,.95), rgba(255,230,170,.92) 40%, rgba(255,214,120,.88) 100%);
  box-shadow: 0 2px 0 rgba(255,210,120,.6) inset, 0 12px 28px rgba(255,214,120,.18), 0 2px 0 rgba(255,255,255,.24);
  font-weight: 700; cursor: pointer; min-height: 44px;
  transition: transform .15s var(--ease-snap), box-shadow .2s var(--ease-snap), filter .2s var(--ease-snap);
}
.sf-add button:hover { transform: translateY(-1px); box-shadow: var(--shadow-2), 0 0 0 1px rgba(255,214,120,.25) inset; }
.sf-add button:active { transform: translateY(0); filter: brightness(.98); }
.sf-add button:focus-visible { outline: none; box-shadow: var(--shadow-glow), 0 0 0 3px rgba(255,214,120,.25); }

/* ---------- List ---------- */
.sf-list { display: grid; gap: .9rem; }
.sf-list .feed-card {
  border-radius: var(--r-xl);
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow-1);
  position: relative;
  overflow: clip;
}
.sf-list .feed-card::after {
  content: ""; position: absolute; inset: 0; pointer-events: none;
  background:
    radial-gradient(60% 40% at 10% -10%, rgba(255,214,120,.10), transparent 60%),
    radial-gradient(60% 40% at 100% 0%, rgba(152,222,255,.08), transparent 60%);
  opacity: .7;
}

/* ---------- Empty/Error ---------- */
.sf-empty {
  border: 1px dashed var(--stroke); color: var(--text-soft);
  background: repeating-linear-gradient(135deg, rgba(255,255,255,.03) 0 8px, rgba(255,255,255,.01) 8px 16px);
  padding: var(--space-3); border-radius: var(--r-lg); text-align: center;
}
.sf-error {
  border: 1px solid rgba(255,120,120,.35);
  background: linear-gradient(180deg, rgba(255, 80, 80, .12), rgba(255, 80, 80, .06));
  color: #ffd5d5; padding: .75rem 1rem; border-radius: var(--r-md);
}

/* ---------- Code & focus ---------- */
.sf code {
  background: rgba(255,255,255,.08); padding: .12rem .42rem; border-radius: 8px;
  border: 1px solid rgba(255,255,255,.14);
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 85%; color: var(--gold-2);
}
:where(.sf *, .sf *::before, .sf *::after) { box-sizing: border-box; }
.sf :focus:not(:focus-visible) { outline: none; }
.sf :focus-visible { outline: 2px solid rgba(255,214,120,.55); outline-offset: 2px; border-radius: 10px; }

/* ---------- Breath animations ---------- */
@keyframes φ-breath-bg { 0% { box-shadow: inset 0 0 0 0 rgba(255,219,128,.04);} 100% { box-shadow: inset 0 0 120px 0 rgba(255,219,128,.10);} }
@keyframes φ-breath-shimmer { 0% { filter: saturate(1) brightness(1);} 100% { filter: saturate(1.06) brightness(1.05);} }

/* ---------- Responsive ---------- */
@media (max-width: 820px) {
  .sf-head { padding: var(--space-2); }
  .sf-reply { padding: var(--space-2); }
  .sf-reply-actions { gap: .5rem; }
  .sf-link, .sf-btn, .sf-btn--ghost { width: 100%; justify-content: center; }
  .sf-add { grid-template-columns: 1fr; }
  .sf-add button { width: 100%; }
}
@media (max-width: 380px) {
  .sf-head, .sf-reply { border-radius: var(--r-lg); }
  .sf-pill { font-size: 12px; padding: .34rem .58rem; }
  .sf-input, .sf-textarea { padding: .72rem .9rem; }
}
@media (min-width: 1200px) { .sf { gap: var(--space-4); } .sf-list { gap: var(--space-3); } }
@media (prefers-contrast: more) {
  .sf-head, .sf-payload, .sf-add textarea, .sf-list .feed-card, .sf-reply, .sf-reply-result { border-color: rgba(255,255,255,.45); }
  .sf-add button, .sf-btn { border-color: rgba(255,223,138,.72); }
}
@media print {
  .sf { background: #fff; color: #000; animation: none; }
  .sf-head, .sf-payload, .sf-list .feed-card, .sf-reply, .sf-reply-result { box-shadow: none; backdrop-filter: none; border: 1px solid #000; }
  .sf-add, .sf-empty, .sf-error { display: none; }
}

/* ---------- Utilities ---------- */
.visually-hidden { position: absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; }

/* ---------- Kai Status (no rotation; progress is breath-synced) ---------- */
.kai-feed-status{
  --dur: var(--pulse-dur, var(--kai-pulse, 5236ms));
  --offset: var(--pulse-offset, 0ms);
  --aqua: rgba(154,230,255,.85);
  --gold: rgba(255,215,128,.95);
  --ink:  rgba(236,241,251,1);
  position: relative; isolation:isolate; overflow: hidden; overflow: clip;
  border-radius: 14px !important; padding:12px 14px !important; color: var(--ink);
  font-variant-numeric: tabular-nums; letter-spacing:.01em;
  background:
    radial-gradient(120% 180% at 12% -10%, rgba(154,230,255,.14), transparent 55%) padding-box,
    radial-gradient(130% 220% at 96% 120%, rgba(255,215,128,.12), transparent 45%) padding-box,
    linear-gradient(135deg, rgba(10,14,22,.86), rgba(12,18,28,.70)) padding-box !important;
  border: 1px solid rgba(255,255,255,.14) !important;
  box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06), inset 0 0 0 1px rgba(255,255,255,.06);
  backdrop-filter: blur(8px) saturate(110%); -webkit-backdrop-filter: blur(8px) saturate(110%);
}
.kai-feed-status::before{
  content:""; position:absolute; inset:-2px; border-radius:inherit; pointer-events:none;
  background:
    radial-gradient(120% 160% at 15% -10%, rgba(154,230,255,.22), transparent 60%),
    radial-gradient(120% 160% at 110% 110%, rgba(255,215,128,.20), transparent 52%),
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  box-shadow: 0 0 0 1px rgba(255,255,255,.04) inset, 0 0 32px rgba(154,230,255,.20) inset, 0 0 42px rgba(255,215,128,.18) inset, 0 12px 38px rgba(0,0,0,.35);
  transform: scale(.996); filter: blur(6px); opacity:.70;
  animation: kai-breathe var(--dur) ease-in-out infinite; animation-delay: var(--offset);
}
.kai-feed-status::after{
  content:""; position:absolute; left:12px; right:12px; bottom:7px; height:3px; border-radius:999px;
  background: linear-gradient(90deg, var(--gold), var(--aqua)); transform-origin:left center; transform: scaleX(.0001);
  box-shadow: 0 0 14px rgba(255,215,128,.45), 0 0 22px rgba(154,230,255,.35);
  animation: kai-progress var(--dur) linear infinite; animation-delay: var(--offset); pointer-events:none;
}
.kai-feed-status strong{ color:var(--ink); text-shadow:0 0 10px rgba(255,215,128,.35), 0 0 18px rgba(154,230,255,.25); }
@keyframes kai-breathe { 0%{opacity:.68;transform:scale(.996);filter:blur(6px);} 50%{opacity:.95;transform:scale(1.004);filter:blur(12px);} 100%{opacity:.68;transform:scale(.996);filter:blur(6px);} }
@keyframes kai-progress { 0%{transform:scaleX(.0001);opacity:.98;} 96%{transform:scaleX(1);opacity:.98;} 99.5%{transform:scaleX(1);opacity:0;} 100%{transform:scaleX(.0001);opacity:0;} }
@media (prefers-reduced-motion: reduce){
  .kai-feed-status::before,.kai-feed-status::after{animation:none;}
  .kai-feed-status::before{opacity:.82;transform:none;filter:none;}
  .kai-feed-status::after{opacity:.75;transform:none;}
}

/* ---------- Kopy → Kopied micro-transition ---------- */
.sf-btn--kopy{ position:relative; --kopied-ms:1100ms; }
.sf-btn--kopy .txt{ transition:opacity 140ms var(--ease-snap); }
.sf-btn--kopy.is-kopied .txt{ opacity:0; }
.sf-btn--kopy::after{
  content:"Kopied"; position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; opacity:0;
  transform:translateY(4px) scale(.98);
  text-shadow:0 0 10px rgba(255,215,128,.35), 0 0 18px rgba(154,230,255,.25);
}
.sf-btn--kopy.is-kopied::after{ animation: kopied-pop var(--kopied-ms) var(--ease-snap) 1 both; }
@keyframes kopied-pop { 0%{opacity:0;transform:translateY(4px) scale(.98);} 12%{opacity:1;transform:translateY(0) scale(1);} 75%{opacity:1;} 100%{opacity:0;transform:translateY(-2px) scale(.995);} }
@media (prefers-reduced-motion: reduce){ .sf-btn--kopy .txt{transition:none;} .sf-btn--kopy.is-kopied::after{animation:none;opacity:1;} }
